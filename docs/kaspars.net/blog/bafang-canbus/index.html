<!DOCTYPE html><html lang="en-US"><head>
	<meta charset="UTF-8">
	<title>Notes on Bafang CAN Bus (Electronics) —  Kaspars Dambis</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="robots" content="max-image-preview:large">
<link rel="alternate" type="application/rss+xml" title="Kaspars Dambis » Feed" href="https://kaspars.net/feed">
<link rel="alternate" type="application/rss+xml" title="Kaspars Dambis » Comments Feed" href="https://kaspars.net/comments/feed">
<link rel="alternate" type="application/rss+xml" title="Kaspars Dambis » Notes on Bafang CAN Bus Comments Feed" href="https://kaspars.net/blog/bafang-canbus/feed">
<style id="global-styles-inline-css" type="text/css">
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel="stylesheet" id="minit-css-css" href="../../wp-content/uploads/minit/c7aa1bc3ef3c368388ee909cc835a652.css" type="text/css" media="all">
<link rel="preload" href="https://kaspars.net/wp-content/uploads/minit/c7aa1bc3ef3c368388ee909cc835a652.css" as="style"><link rel="https://api.w.org/" href="https://kaspars.net/wp-json/"><link rel="alternate" title="JSON" type="application/json" href="https://kaspars.net/wp-json/wp/v2/posts/9135"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://kaspars.net/xmlrpc.php?rsd">
<meta name="generator" content="WordPress 6.6.2">
<link rel="canonical" href="https://kaspars.net/blog/bafang-canbus">
<link rel="shortlink" href="https://kaspars.net/9135">
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://kaspars.net/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fkaspars.net%2Fblog%2Fbafang-canbus">
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://kaspars.net/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fkaspars.net%2Fblog%2Fbafang-canbus&amp;format=xml">
<link rel="alternate" type="application/activity+json" href="https://kaspars.net/blog/bafang-canbus">
		<style>
			#stand_with_ukraine_overlay {
				border: 10px solid #0057B8;
				padding: 5px;
				text-align: center;
				text-combine: #0057B8;
				background-color: #FFD700;
			}
			#stand_with_ukraine_overlay a {
				display: inline-block;
				padding: 3px 6px;
				color: #0057B8;
				border: 2px transparent dashed;
				text-decoration: underline;
			}
			#stand_with_ukraine_overlay a:hover,
			#stand_with_ukraine_overlay a:focus {
				border: 2px #0057B8 dashed;
				text-decoration: underline;
			}
		</style>
	<meta property="fediverse:creator" name="fediverse:creator" content="kaspars@kaspars.net">
<meta property="og:site_name" content="Kaspars Dambis">
<meta property="og:title" content="Notes on Bafang CAN Bus">
<meta property="og:description" content="Bafang M200 mid-drive motor (model MM G210.250.C) with 36V battery connector (yellow, from left), empty 6-pin electric break connector (purp...">
<meta property="og:type" content="article">
<meta property="og:image" content="../../wp-content/uploads/2024/04/bafang-m200-motor-connectors-scaled.jpg">
<meta property="og:url" content="https://kaspars.net/blog/bafang-canbus">
<link rel="icon" type="image/png" href="../../__reverse.kaspars.net/gravatar/avatar/661eb21385c25c01ad64ab9e13b37331/s%3D300%26d%3Dmm%26r%3Dg">
<link rel="alternate" type="application/activity+json" href="https://kaspars.net/blog/bafang-canbus">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link rel="icon" href="../../wp-content/uploads/2022/01/cropped-kaspars-dambis-square-small-32x32.jpeg" sizes="32x32">
<link rel="icon" href="../../wp-content/uploads/2022/01/cropped-kaspars-dambis-square-small-192x192.jpeg" sizes="192x192">
<link rel="apple-touch-icon" href="../../wp-content/uploads/2022/01/cropped-kaspars-dambis-square-small-180x180.jpeg">
<meta name="msapplication-TileImage" content="https://kaspars.net/wp-content/uploads/2022/01/cropped-kaspars-dambis-square-small-270x270.jpeg">
<link rel="webmention" href="https://kaspars.net/wp-json/webmention/1.0/endpoint">
<link rel="http://webmention.org/" href="https://kaspars.net/wp-json/webmention/1.0/endpoint">
		<style type="text/css" id="wp-custom-css">
			.yarpp-related li a { font-weight:normal; padding:0.25em 0; }
.yarpp-related ul { margin-left:0; margin-right:0; padding-left:0; }

.is-type-video .wp-block-embed__wrapper { background-color:#ddd; }

figure figcaption { text-align:center; font-style:italic; font-size:0.9em; }

.wp-block-gallery ul { margin-left:0; }


#stand_with_ukraine_overlay { min-height:2.2em; } 		</style>
		</head>
<body class="post-template-default single single-post postid-9135 single-format-standard custom-background wp-embed-responsive has-header-image">

<div class="wrap wrap-header">
	<div class="wrap-section-in">

		
		<nav id="header" role="navigation">

			<p id="logo" role="banner">
				<a href="../../" title="Kaspars Dambis" rel="home">
					<img src="../../__reverse.kaspars.net/gravatar/avatar/661eb21385c25c01ad64ab9e13b37331/s%3D300%26d%3Dmm%26r%3Dg" width="300" height="300" alt="Kaspars Dambis" title="Kaspars Dambis" class="custom-logo" decoding="async">					<strong>Kaspars Dambis</strong>
				</a>
				<em>WordPress, Electronics &amp; Home Automation</em>
			</p>

			<a id="nav-main-toggle" href="#nav-main">Menu</a>
					<div id="nav-main" class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-9331" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-9331"><a title="Advanced WordPress Courses" href="../../courses/">Courses</a></li>
<li id="menu-item-9416" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-9416"><a title="Enterprise WordPress Consulting" href="../../consulting/">Consulting</a></li>
<li id="menu-item-4174" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-has-children menu-item-4174"><a title="Blog About Web Design, WordPress and Performance" href="../">Blog</a>
<ul class="sub-menu">
	<li id="menu-item-4884" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-4884"><a title="Latest Blog Posts" href="../">Latest Posts</a></li>
	<li id="menu-item-6198" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-6198"><a title="My video blog about electronics and digital products" href="../topic/vlog/">Video Blog</a></li>
	<li id="menu-item-4943" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4943"><a title="Archive of all blogs posts" href="../archive/">All Posts</a></li>
	<li id="menu-item-6242" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6242"><a href="../../subscribe/">Subscribe</a></li>
</ul>
</li>
<li id="menu-item-4176" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-4176"><a title="About Kaspars Dambis" rel="author me" href="../../about/">About</a>
<ul class="sub-menu">
	<li id="menu-item-5784" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5784"><a href="../../about/">About Me</a></li>
	<li id="menu-item-4178" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4178"><a title="Contact Kaspars Dambis" href="../../contact/">Contact</a></li>
	<li id="menu-item-5824" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5824"><a title="What I’m Doing Now…" href="../../now/">Now</a></li>
	<li id="menu-item-6726" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6726"><a title="My toolbox of products and services I love" href="../../uses/">Tools &amp; Services</a></li>
	<li id="menu-item-4168" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4168"><a href="../../projects/">Projects</a></li>
	<li id="menu-item-6925" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6925"><a title="My bookshelf" href="../../reads/">Books</a></li>
</ul>
</li>
</ul></div>		</nav>

		
	</div>
</div>

<div class="wrap wrap-content-main">
	<div class="wrap-section-in">

		<div id="content-main" class="hfeed" role="main">

		<div class="breadcrumb breadcrumb-count-3" itemprop="breadcrumb"><a href="../../">Home</a> → <a href="../">Blog</a> → <a href="../topic/electronics/" rel="category tag">Electronics</a> →</div>
		
		<article class="post-9135 post type-post status-publish format-standard has-post-thumbnail hentry category-electronics has-featured-image" id="post-9135" role="article">

			
						<h1 class="entry-title" role="heading">
					Notes on Bafang CAN Bus			</h1>
			
			
			<div class="post-meta post-meta-header">
				<span class="meta-item meta-published time published">
			<abbr title="Sun, 21 Apr 2024 23:54:56 +0300">April 21, 2024</abbr>
		</span> <span class="meta-item meta-updated time updated">
			<span class="value-title" title="Sun, 02 Jun 2024 16:14:23 +0300"></span>
		</span> <span class="meta-item meta-author author vcard">
			<span class="name fn">
				<span class="value-title" title="Kaspars"></span>
			</span>
		</span> <span class="meta-item meta-category category"><a href="../topic/electronics/" rel="category tag">Electronics</a></span>  <span class="meta-item meta-comment-count">
			<a href="#comments">1&nbsp;Comment</a>
		</span>			</div>

			
			<div class="entry-content">
				
<figure class="wp-block-image alignwide size-full"><img loading="lazy" decoding="async" width="2560" height="1920" src="../../wp-content/uploads/2024/04/bafang-m200-motor-connectors-scaled.jpg" alt="Bafang M200 (M-series) mid-drive motor with CAN bus" class="wp-image-9137" srcset="../../wp-content/uploads/2024/04/bafang-m200-motor-connectors-scaled.jpg 2560w, ../../wp-content/uploads/2024/04/bafang-m200-motor-connectors-1280x960.jpg 1280w, ../../wp-content/uploads/2024/04/bafang-m200-motor-connectors-1920x1440.jpg 1920w, ../../wp-content/uploads/2024/04/bafang-m200-motor-connectors-1536x1152.jpg 1536w, ../../wp-content/uploads/2024/04/bafang-m200-motor-connectors-2048x1536.jpg 2048w" sizes="(max-width: 2560px) 100vw, 2560px"><figcaption class="wp-element-caption">Bafang M200 mid-drive motor (model <code>MM G210.250.C</code>) with 36V battery connector (yellow, from left), empty 6-pin electric break connector (purple), 8-pin rear light and wheel speed connector, and 8-pin front light and display connector.</figcaption></figure>



<p>I got my wife this <a href="https://accolmile.com/products/aantelope-1s">Accolmile Antelope 1S</a> electric bicycle with Bafang components from their latest <a href="https://www.bafang-e.com/en/products/motors/m-series/">M-series lineup of mid-drive motors</a> and <a href="https://www.bafang-e.com/en/oem-area/components/hmi/">displays</a> which communicate over a CAN bus. It’s a great city bike and the price includes fast shipping from the warehouse in Poland. Their support was also quick to send a replacement wheel for the original that got dented during transport (despite the thoughtful packaging).</p>



<h2 class="wp-block-heading">CAN over NodeJS</h2>



<p>The M500/M600 motors are particularly popular with MTB riders so the communication protocol has been discussed in <a href="https://endless-sphere.com/sphere/threads/bafang-m500-m600-thread.100777/">this forum thread</a> and documented in <a href="https://github.com/OpenSourceEBike/Bafang_M500_M600">this GitHub repository</a>. Importantly, the <a href="https://bafang-e.com/en/oem-area/service/besst/"><abbr title="Bafang E-mobility Sales &amp; Service Tool">BESST</abbr> software</a> for managing the configuration and firmware updates is <a href="https://www.electronjs.org">an Electron app</a> with all logic as plain HTML and JS files (and bundled <a href="https://developer.chrome.com/blog/sourcemaps">source maps</a> for all minified code), including the CAN frame specification. I’ve started documenting my research in <a href="https://github.com/kasparsd/besst-reference">this GitHub repository</a>.</p>



<span id="more-9135"></span>



<h2 class="wp-block-heading">Connecting to CAN Bus</h2>



<p>The display connector at the wheel is the most convenient place to tap into the CAN bus. I purchased two HIGO 5-pin connectors B5-F and S5-F from <a href="https://shop.e-bike-technologies.de/de/">ETShop in Germany</a> for around €7 each and soldered the CAN high (green), CAN low (white) and ground (black) wires from each for a connection to (a copy of) the <a href="https://canable.io">CANable Pro 1.0 CAN-to-USB adapter</a>. <strong>Be sure to test the wiring with a multimeter because one of the wires carries the full battery voltage!</strong></p>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="2560" height="1920" src="../../wp-content/uploads/2024/04/bafang-higo-s5-male-connector-scaled.jpeg" alt="HIGO S5-F connector wires for Bafang CAN bus" class="wp-image-9141" srcset="../../wp-content/uploads/2024/04/bafang-higo-s5-male-connector-scaled.jpeg 2560w, ../../wp-content/uploads/2024/04/bafang-higo-s5-male-connector-1280x960.jpeg 1280w, ../../wp-content/uploads/2024/04/bafang-higo-s5-male-connector-1920x1440.jpeg 1920w, ../../wp-content/uploads/2024/04/bafang-higo-s5-male-connector-1536x1152.jpeg 1536w, ../../wp-content/uploads/2024/04/bafang-higo-s5-male-connector-2048x1536.jpeg 2048w" sizes="(max-width: 2560px) 100vw, 2560px"></figure>



<p>Technically <em>any CAN-to-USB adapter will work</em> (as long as it supports 250kbit transfer rate) and the choice depends more on the software you want to use for interacting with the bus. The CANable adapter runs the <a href="https://github.com/normaldotcom/canable-fw">slcan firmware</a> which implements the <a href="https://www.canusb.com/products/canusb/">Lawicel SLCAN protocol</a> (a basic ASCII serial) which is supported by various libraries, including SocketCAN.</p>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="2560" height="2560" src="../../wp-content/uploads/2024/04/bafang-can-bus-higo-s5-b5-canable-pro-scaled.jpeg" alt="Bafang HIGO S5 and B5 connectors attached to CANable Pro" class="wp-image-9142" srcset="../../wp-content/uploads/2024/04/bafang-can-bus-higo-s5-b5-canable-pro-scaled.jpeg 2560w, ../../wp-content/uploads/2024/04/bafang-can-bus-higo-s5-b5-canable-pro-1280x1280.jpeg 1280w, ../../wp-content/uploads/2024/04/bafang-can-bus-higo-s5-b5-canable-pro-1920x1920.jpeg 1920w, ../../wp-content/uploads/2024/04/bafang-can-bus-higo-s5-b5-canable-pro-300x300.jpeg 300w, ../../wp-content/uploads/2024/04/bafang-can-bus-higo-s5-b5-canable-pro-1536x1536.jpeg 1536w, ../../wp-content/uploads/2024/04/bafang-can-bus-higo-s5-b5-canable-pro-2048x2048.jpeg 2048w, ../../wp-content/uploads/2024/04/bafang-can-bus-higo-s5-b5-canable-pro-120x120.jpeg 120w" sizes="(max-width: 2560px) 100vw, 2560px"><figcaption class="wp-element-caption">HIGO 5-pin B5-F and S5-F connectors attached to CANable Pro 1.0 CAN-to-USB adaptor.</figcaption></figure>



<figure class="wp-block-image alignwide size-full"><img loading="lazy" decoding="async" width="2560" height="1920" src="../../wp-content/uploads/2024/04/cangaroo-can-bus-bafang-m200-motor-dp-c245-scaled.jpeg" alt="CANbus traffic between Bafang M200 and DP C245 display." class="wp-image-9143" srcset="../../wp-content/uploads/2024/04/cangaroo-can-bus-bafang-m200-motor-dp-c245-scaled.jpeg 2560w, ../../wp-content/uploads/2024/04/cangaroo-can-bus-bafang-m200-motor-dp-c245-1280x960.jpeg 1280w, ../../wp-content/uploads/2024/04/cangaroo-can-bus-bafang-m200-motor-dp-c245-1920x1440.jpeg 1920w, ../../wp-content/uploads/2024/04/cangaroo-can-bus-bafang-m200-motor-dp-c245-1536x1152.jpeg 1536w, ../../wp-content/uploads/2024/04/cangaroo-can-bus-bafang-m200-motor-dp-c245-2048x1536.jpeg 2048w" sizes="(max-width: 2560px) 100vw, 2560px"><figcaption class="wp-element-caption">Logging CANbus traffic between Bafang M200 (G210.250.C) motor and DP C245 display.</figcaption></figure>



<h2 class="wp-block-heading">Update Controller Configuration</h2>



<p>I was able to test the setup by increasing the assisted maximum speed to 60km/h from the original 25km/h by sending <a href="https://github.com/kasparsd/besst-reference/blob/47b3139c6dc672b90358e546abc30992b20d48c9/app/static/js/webpack/device/controller.js#L652-L663">a CAN message</a> composed of the following components:</p>



<ul class="wp-block-list">
<li><code>0x05</code> for the <a href="https://github.com/kasparsd/besst-reference/blob/47b3139c6dc672b90358e546abc30992b20d48c9/app/static/js/webpack/node_modules/besst-usb-sdk/src/usbClient/common.js#L41-L53">message source</a> (<code>0x01</code> — torque sensor, <code>0x02</code> — controller, <code>0x03</code> — display or HMI, <code>0x04</code> — battery, <code>0x05</code> — BESST),</li>



<li><code>0x02</code> for the message target (controller),</li>



<li><code>0x00</code> for a WRITE <a href="https://github.com/kasparsd/besst-reference/blob/47b3139c6dc672b90358e546abc30992b20d48c9/app/static/js/webpack/node_modules/besst-usb-sdk/src/usbClient/common.js#L55-L68">operation</a> (<code>0x01</code> for READ),</li>
</ul>



<p>which are transformed into a frame ID prefix for the <code>0x3203</code> code and subcode for “speed limit, wheel diameter and circumference” registry through <a href="https://github.com/kasparsd/besst-reference/blob/47b3139c6dc672b90358e546abc30992b20d48c9/app/static/js/webpack/node_modules/besst-usb-sdk/src/usbClient/common.js#L229-L237">this transformer function</a>:</p>



<pre class="wp-block-code"><code>buildHexStringCommand = (source, target, opt, anfn, nfn) =&gt; {
    const cmdPrefix = hexAllocToBinaryStr(source.toString(16), 5) + hexAllocToBinaryStr(target.toString(16), 5) + hexAllocToBinaryStr(opt.toString(16), 3);
    let cmdPrefixHex = parseInt(cmdPrefix, 2).toString(16);
    if (cmdPrefixHex.length % 2 !== 0) {
        cmdPrefixHex = '0' + cmdPrefixHex;
    }
    let cmdHexString = cmdPrefixHex + anfn + nfn;
    return hexReverse(cmdHexString);
};</code></pre>



<p>which returns:</p>



<pre class="wp-block-code"><code>05 10 32 03</code></pre>



<p>as the frame ID along with the payload:</p>



<pre class="wp-block-code"><code>70 17 C0 2B B6 08 </code></pre>



<p>where (with little-endian byte order):</p>



<ul class="wp-block-list">
<li><code>0x1770</code> is 6000 or 60km/h × 100,</li>



<li><code>0x2BC0</code> is 700 or 700c wheel diameter (29-inch), and</li>



<li><code>0x08B6</code> is 2230 or 2230mm wheel circumference.</li>
</ul>
			</div>

			<ul class="post-nav">
				<li><h4 class="prev"><a href="../usb-c-pd65w-adapter-charger-18v-20v-batteries/" rel="prev">USB-C PD65W Adapter and Charger for 18V and 20V Power Tool Batteries</a></h4></li><li><h4 class="next"><a href="../airbank-d13-pro-teardown/" rel="next">Airbank D13 Puffer Pro Pump Teardown</a></h4></li>			</ul>

			
		</article>

		<div class="yarpp yarpp-related yarpp-related-website yarpp-template-list">
<!-- YARPP List -->
<h3>Related posts:</h3><ol>
<li><a href="../diy-electric-skatboard-hub-motor-trucks/" rel="bookmark" title="Part 1: DIY Electric Skatboard, Hub Motor &amp; Trucks">Part 1: DIY Electric Skatboard, Hub Motor &amp; Trucks</a></li>
<li><a href="../gree-amber-nordic-gwh09yd-s6dba1/" rel="bookmark" title="Notes on Gree Amber Nordic / Prestige GWH09YD-S6DBA2A Heat Pump">Notes on Gree Amber Nordic / Prestige GWH09YD-S6DBA2A Heat Pump</a></li>
<li><a href="../mysensors-notes/" rel="bookmark" title="Notes on MySensors">Notes on MySensors</a></li>
<li><a href="../fvt-firmware/" rel="bookmark" title="Decoding the FVT ESC Firmware">Decoding the FVT ESC Firmware</a></li>
</ol>
</div>

			<div class="comments-wrap">
		<div class="comments has-comments" id="comments">

							<h2 class="comments-title">
					1 Comment				</h2>

				<ol class="commentlist">
							<li class="comment even thread-even depth-1" id="comment-397285">
				<div id="div-comment-397285" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="../../__reverse.kaspars.net/gravatar/avatar/144d92ecab1449bdef888f9de4f337d8/s%3D64%26d%3Dmm%26r%3Dg" srcset="../../__reverse.kaspars.net/gravatar/avatar/144d92ecab1449bdef888f9de4f337d8/s%3D128%26d%3Dmm%26r%3Dg 2x" class="avatar avatar-64 photo" height="64" width="64" onerror="this.onerror=null;this.src='https://kaspars.net/wp-content/plugins/webmention/assets/img/mm.jpg';this.srcset='https://kaspars.net/wp-content/plugins/webmention/assets/img/mm.jpg';" loading="lazy" decoding="async">			<cite class="fn">Andrey</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="#comment-397285">June 2, 2024 at 00:31</a>		</div>

		<p>Hello. Maybe you will be interested in my project <a href="https://github.com/andrey-pr/OpenBafangTool" rel="nofollow ugc">https://github.com/andrey-pr/OpenBafangTool</a> . Its desktop configuration (and diagnostic) software for bafangs with can, and its already usable</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-link" href="https://kaspars.net/blog/bafang-canbus?replytocom=397285#respond" data-commentid="397285" data-postid="9135" data-belowelement="div-comment-397285" data-respondelement="respond" data-replyto="Reply to Andrey" aria-label="Reply to Andrey">Reply</a></div>
				</div>
				</li><!-- #comment-## -->
				</ol>

							
				<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://kaspars.net/wp-comments-post.php" method="post" id="commentform" class="comment-form"><p class="comment-form-comment"><label for="comment">Comment <span class="required">*</span></label> <textarea autocomplete="new-password" id="bfac3e1ff0" name="bfac3e1ff0" cols="45" rows="8" maxlength="65525" required="required"></textarea><textarea id="comment" aria-label="hp-comment" aria-hidden="true" name="comment" autocomplete="new-password" style="padding:0 !important;clip:rect(1px, 1px, 1px, 1px) !important;position:absolute !important;white-space:nowrap !important;height:1px !important;width:1px !important;overflow:hidden !important;" tabindex="-1"></textarea><script data-noptimize="">document.getElementById("comment").setAttribute( "id", "a5b51720c12dade51459b1915b7845f9" );document.getElementById("bfac3e1ff0").setAttribute( "id", "comment" );</script></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" autocomplete="name" required="required"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" autocomplete="email" required="required"></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" autocomplete="url"></p>
<p class="comment-form-notify-me">
			<label>
			<input type="checkbox" name="comment-approved_notify-me" value="1">
			Notify me by email when the comment gets approved.
			</label>
			</p><input type="hidden" name="wp-comment-cookies-consent" value="1"><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="9135" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p></form>	</div><!-- #respond -->
	<form id="webmention-form" action="https://kaspars.net/wp-json/webmention/1.0/endpoint" method="post">
	<p>
		<label for="webmention-source">To respond on your own website, enter the URL of your response which should contain a link to this post's permalink URL. Your response will then appear (possibly after moderation) on this page. Want to update or remove your response? Update or delete your post and re-enter your post's URL again. (<a href="https://indieweb.org/webmention">Learn More</a>)</label>
	</p>
	<p>
		<input id="webmention-source" type="url" autocomplete="url" required="" pattern="^https?:\/\/(.*)" name="source" placeholder="URL/Permalink of your article">
	</p>
	<p>
		<input id="webmention-submit" type="submit" name="submit" value="Ping me!">
	</p>
	<input id="webmention-format" type="hidden" name="format" value="html">
	<input id="webmention-target" type="hidden" name="target" value="https://kaspars.net/blog/bafang-canbus">
</form>

		</div><!-- #comments -->
	</div>
	
		
		
		</div><!-- content-main -->
	</div><!-- wrap -->
</div>

<div class="wrap wrap-footer" role="contentinfo">
	<div class="wrap-section-in">

		
				<div id="footer">
			<aside id="text-17" class="widget widget_text"><h1 class="widget-title">Check out my WordPress products</h1>			<div class="textwidget"><p><a href="https://widgetcontext.com">Widget Context</a> for widget visibility, <a href="https://preseto.com/go/cf7-storage">Storage</a> and <a href="https://formcontrols.com">Controls</a> for Contact Form 7. Learn more about <a href="../../projects/">my projects →</a></p>
</div>
		</aside><aside id="convertkit_form-2" class="widget convertkit widget_convertkit_form"><h1 class="widget-title">Subscribe to My Newsletter</h1><script async="" data-uid="cda85cd940" src="https://wpelevator.ck.page/cda85cd940/index.js" data-jetpack-boost="ignore" data-no-defer="1" nowprocket=""></script></aside>
		<aside id="recent-posts-3" class="widget widget_recent_entries">
		<h1 class="widget-title">Recent Posts</h1>
		<ul>
											<li>
					<a href="../nginx-rate-limit-php/">How to Rate Limit Requests to Specific PHP Files with Nginx</a>
									</li>
											<li>
					<a href="../applescript-resize-all-windows/">Use AppleScript to Resize All Windows for Screen Recording</a>
									</li>
											<li>
					<a href="../airbank-d13-pro-teardown/">Airbank D13 Puffer Pro Pump Teardown</a>
									</li>
											<li>
					<a href="" aria-current="page">Notes on Bafang CAN Bus</a>
									</li>
											<li>
					<a href="../usb-c-pd65w-adapter-charger-18v-20v-batteries/">USB-C PD65W Adapter and Charger for 18V and 20V Power Tool Batteries</a>
									</li>
											<li>
					<a href="../solar-lora-meshtastic/">Building a Solar Powered Lora Meshtastic Community Network</a>
									</li>
											<li>
					<a href="../powerwalker-vi-500-r1u/">Notes on PowerWalker VI 500 R1U UPS</a>
									</li>
											<li>
					<a href="../beelink-u59-pro-n5105/">Notes on Beelink U59 Pro (Intel N5105) as a Home Server</a>
									</li>
											<li>
					<a href="../neo-nas-zw05b0-tuya-zigbee-homekit-hub/">Notes on NEO Tuya Zigbee HomeKit Hub</a>
									</li>
											<li>
					<a href="../nilan-compact-p2-geo3-polar/">Notes on Nilan Compact P2 GEO3 Polar</a>
									</li>
					</ul>

		</aside><aside id="categories-3" class="widget widget_categories"><h1 class="widget-title">Blog Topics</h1>
			<ul>
					<li class="cat-item cat-item-174"><a href="../topic/cryptography/">Cryptography</a>
</li>
	<li class="cat-item cat-item-3"><a href="../topic/design/">Design</a>
</li>
	<li class="cat-item cat-item-147"><a href="../topic/dev/">Development</a>
</li>
	<li class="cat-item cat-item-156"><a href="../topic/electronics/">Electronics</a>
</li>
	<li class="cat-item cat-item-188"><a href="../topic/home-automation/">Home Automation</a>
</li>
	<li class="cat-item cat-item-155"><a href="../topic/linux/">Linux</a>
</li>
	<li class="cat-item cat-item-114"><a href="../topic/meta/">Meta</a>
</li>
	<li class="cat-item cat-item-115"><a href="../topic/observatory/">Observatory</a>
</li>
	<li class="cat-item cat-item-189"><a href="../topic/passive-house/">Passive House</a>
</li>
	<li class="cat-item cat-item-5"><a href="../topic/media-publishing/">Publishing</a>
</li>
	<li class="cat-item cat-item-184"><a href="../topic/vlog/">Video Blog</a>
</li>
	<li class="cat-item cat-item-136"><a href="../topic/performance/">Web Performance</a>
</li>
	<li class="cat-item cat-item-9"><a href="../topic/wordpress/">WordPress</a>
</li>
			</ul>

			</aside>		</div>
		
		<div class="footer-menu-wrap">
					<strong class="home"><a href="../../">Kaspars Dambis</a></strong>
					<div id="nav-footer" class="menu-personal-links-container"><ul id="menu-personal-links" class="menu"><li id="menu-item-4829" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-4829"><a title="Blog about WordPress plugin development, website performance and optimization" href="../">Blog</a></li>
<li id="menu-item-5187" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5187"><a title="About Kaspars Dambis" rel="author" href="../../about/">About</a></li>
<li id="menu-item-5188" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-5188"><a title="Contact Kaspars Dambis" href="../../contact/">Contact</a></li>
<li id="menu-item-6908" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6908"><a title="My blog in Latvian" rel="me" href="https://kasparsdambis.lv">Latviski</a></li>
</ul></div>
				</div><div id="nav-social" class="menu-social-links-container"><ul id="menu-social-links" class="menu"><li id="menu-item-5185" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5185"><a title="My code on GitHub" rel="me" href="https://github.com/kasparsd/">GitHub Profile</a></li>
<li id="menu-item-5186" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5186"><a title="My WordPress profile" rel="me" href="https://profiles.wordpress.org/kasparsd">WordPress Profile</a></li>
<li id="menu-item-5184" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5184"><a title="Kaspars on Twitter" rel="me" href="https://twitter.com/konstruktors">Twitter</a></li>
<li id="menu-item-8591" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8591"><a title="Follow on Mastadon (ActivityPub)" rel="me" href="https://mastodon.social/@kasparsd">Mastadon</a></li>
<li id="menu-item-6160" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6160"><a title="My Video Blog" rel="me" href="https://www.youtube.com/kasparsdambis">YouTube</a></li>
<li id="menu-item-5195" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5195"><a title="My photos on Flickr" rel="me" href="https://www.flickr.com/photos/kasparsdambis/">Flickr</a></li>
<li id="menu-item-5793" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5793"><a title="My Instagram Photos" rel="me" href="https://www.instagram.com/kasparsd/">Instagram</a></li>
<li id="menu-item-6512" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6512"><a title="My Micro Blog" rel="me" href="https://micro.blog/kaspars">Micro.blog</a></li>
</ul></div>
		
		<div class="theme-credits"><p>Powered by <a href="https://wordpress.org">WordPress</a> and <a href="https://preseto.com/themes/list">List Theme</a>.</p></div>	</div>
</div>

<script type="text/javascript" id="minit-js-js-extra">
/* <![CDATA[ */
var swu_options = {"text":"Stand With Ukraine","hashtag":"#StandWithUkraine","url":"https:\/\/war.ukraine.ua\/"};
/* ]]> */
</script>
<script async="" type="text/javascript" defer="" src="../../wp-content/uploads/minit/83067bfb7b491520abc941f1d73c5bc2.js" id="minit-js-js"></script>

<!-- Script helper footer: -->
<script defer="" src="../../__reverse.kaspars.net/gtm/gtag/js/id%3DG-4GVR01JRX8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-4GVR01JRX8');
</script>


<!--
	List Theme by Preseto at https://preseto.com
	87 queries in 0.3648 seconds on Mon, 21 Oct 2024 12:07:54 +0000.-->



</body></html>